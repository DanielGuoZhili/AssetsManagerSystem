# 📊 每月收支管理页面

完整的每月收支追踪和分析工具，包含数据可视化、详细记录管理和历史数据查询功能。

## 🎯 功能概览

### 1. 数据可视化（三种图表）

#### 📊 饼图 - 当月支出分类
- 显示当前选中月份的支出分类占比
- 自动按分类（住房、保险、日常、订阅等）汇总
- 交互式图表，可点击查看详情

#### 📈 柱状图 - 近3个月收支对比
- 并排显示近3个月的收入和支出
- 收入显示为绿色，支出显示为红色
- 顶部显示金额标签（以万元为单位）

#### 📉 折线图 - 近3个月收支趋势
- 显示收入、支出和余额三条趋势线
- 收入（绿色）、支出（红色）、余额（蓝色）
- 可清晰看出财务走势

### 2. 月度记录管理

#### 创建月度记录
1. 点击"新建月度记录"按钮
2. 选择月份
3. 可选添加备注
4. 保存后自动创建空白记录

#### 编辑月度记录
- 点击表格中的"编辑"按钮
- 可修改月份和备注
- 收入支出会根据明细项目自动计算

#### 删除月度记录
- 点击"删除"按钮
- 确认后删除整个月度记录
- ⚠️ 删除后无法恢复

### 3. 收支项目管理

#### 添加收支项目
1. 先选择要操作的月份（点击表格行）
2. 点击"添加收支项目"按钮
3. 填写项目信息：
   - 项目名称（如：工资、房租）
   - 类型（收入/支出）
   - 分类（如：住房、保险、日常）
   - 金额
4. 保存后自动更新月度总额

#### 编辑项目
- 在明细表格中点击"编辑"
- 修改后自动重新计算月度总额

#### 删除项目
- 点击"删除"按钮
- 确认后删除该项目
- 月度总额自动更新

### 4. 数据联动

所有数据都是联动的：

```
添加/编辑/删除项目
      ↓
自动更新月度收入/支出总额
      ↓
图表自动刷新
      ↓
统计卡片自动更新
```

## 📋 页面布局

```
┌─────────────────────────────────────────────────┐
│ 📊 每月收支管理                                  │
├─────────────────────────────────────────────────┤
│ [饼图]          [柱状图]          [折线图]       │
│ 当月支出分类     近3月收支对比     近3月趋势     │
├─────────────────────────────────────────────────┤
│ [收入卡片]      [支出卡片]        [余额卡片]     │
├─────────────────────────────────────────────────┤
│ 2024-11 收支明细                  [添加项目]     │
│ ┌─────────────────────────────────────────┐    │
│ │ 项目名称 │ 类型 │ 分类 │ 金额 │ 操作 │    │
│ │ 工资    │ 收入 │ 收入 │ 400k │ 编辑删除 │    │
│ │ 房租    │ 支出 │ 住房 │ 85k  │ 编辑删除 │    │
│ └─────────────────────────────────────────┘    │
├─────────────────────────────────────────────────┤
│ 月度收支记录                      [新建记录]     │
│ ┌─────────────────────────────────────────┐    │
│ │ 月份   │ 收入  │ 支出  │ 余额 │ 操作 │    │
│ │ 2024-11│ 400k │ 320k │ 80k  │ 编辑删除 │    │
│ │ 2024-10│ 400k │ 310k │ 90k  │ 编辑删除 │    │
│ └─────────────────────────────────────────┘    │
└─────────────────────────────────────────────────┘
```

## 🎨 使用场景

### 场景1：记录当月收支

**步骤**：
1. 系统已有当月（2024-11）记录
2. 点击该月份行（高亮显示）
3. 点击"添加收支项目"
4. 填写工资收入 ¥400,000
5. 继续添加各项支出（房租、年金等）
6. 查看顶部统计卡片和图表自动更新

### 场景2：查看历史趋势

**步骤**：
1. 查看顶部折线图
2. 观察近3个月的收支变化
3. 点击表格中的历史月份
4. 查看该月的详细明细

### 场景3：分析支出结构

**步骤**：
1. 选择要分析的月份
2. 查看饼图中的支出分类占比
3. 识别最大开支项目
4. 调整预算计划

### 场景4：月度对比

**步骤**：
1. 查看柱状图
2. 对比近3个月的收入支出
3. 分析波动原因
4. 调整支出策略

## 💾 数据存储

### 本地存储
- 所有数据保存在 `localStorage` 的 `monthlyRecords` 键中
- JSON 格式存储
- 浏览器本地，数据私密安全

### 数据结构
```typescript
interface MonthlyRecord {
  id: string
  month: string           // 格式：YYYY-MM
  income: number          // 总收入（自动计算）
  expense: number         // 总支出（自动计算）
  items: IncomeExpenseItem[]  // 明细项目
  note?: string           // 备注
}

interface IncomeExpenseItem {
  id: string
  name: string           // 项目名称
  amount: number         // 金额
  type: 'income' | 'expense'  // 类型
  category: string       // 分类
}
```

### 预置数据
系统预置了2024年9-11月的示例数据，包括：
- 工资收入
- 房租、年金、保险等固定支出
- 信用卡、订阅服务等变动支出

## 🎯 分类建议

### 收入分类
- 收入（工资、奖金等）
- 兼职收入
- 投资收益
- 其他收入

### 支出分类
- **住房**：房租、物业费
- **保险**：年金、保险费
- **日常**：信用卡消费、生活费
- **订阅**：各类订阅服务
- **税金**：住民税等
- **投资**：股票、基金投资
- **娱乐**：旅游、购物
- **其他**：杂项支出

## 📊 图表说明

### 饼图配置
- **数据源**：当前选中月份的所有支出项目
- **分组依据**：category 字段
- **显示格式**：名称 + 百分比
- **交互**：点击高亮

### 柱状图配置
- **数据源**：最近3个月的记录
- **显示内容**：每月的收入和支出
- **颜色**：绿色（收入）、红色（支出）
- **标签**：顶部显示金额（万元）

### 折线图配置
- **数据源**：最近3个月的记录
- **三条线**：
  - 绿色：收入趋势
  - 红色：支出趋势
  - 蓝色：余额趋势
- **交互**：鼠标悬停显示具体数值

## 💡 使用技巧

### 1. 快速选择月份
直接点击表格中的任意月份行，即可切换到该月份查看详情。选中的月份行会高亮显示。

### 2. 批量录入
对于固定支出（房租、保险等），建议：
1. 先在一个月份完整录入
2. 下个月可以参考上月数据
3. 只需修改变动项目

### 3. 定期分析
建议每月月初：
1. 创建当月记录
2. 录入收入
3. 录入已知的固定支出
4. 月末补充变动支出
5. 查看图表分析

### 4. 分类规范
保持分类命名一致，这样：
- 饼图更准确
- 便于统计分析
- 便于跨月对比

### 5. 备注使用
在月度记录的备注中可以记录：
- 特殊事件（旅游、购物等）
- 大额支出原因
- 计划外收入来源

## 🔧 数据管理

### 导出数据（当前方法）
1. 打开浏览器开发者工具（F12）
2. 在 Console 输入：
```javascript
const data = localStorage.getItem('monthlyRecords')
console.log(JSON.parse(data))
```
3. 复制输出的 JSON 数据
4. 保存到文本文件

### 导入数据（当前方法）
1. 打开浏览器开发者工具（F12）
2. 在 Console 输入：
```javascript
const data = [/* 粘贴您的数据 */]
localStorage.setItem('monthlyRecords', JSON.stringify(data))
```
3. 刷新页面

### 清空所有数据
```javascript
localStorage.removeItem('monthlyRecords')
```

## 🚀 未来功能规划

### Phase 1 - 数据增强
- [ ] 预算设置功能
- [ ] 超支预警
- [ ] 同比环比分析
- [ ] 年度统计

### Phase 2 - 导出功能
- [ ] Excel 导出
- [ ] PDF 报表
- [ ] CSV 导出
- [ ] 图表导出

### Phase 3 - 高级分析
- [ ] 支出趋势预测
- [ ] 智能分类建议
- [ ] 异常支出检测
- [ ] 储蓄目标追踪

### Phase 4 - 云端同步
- [ ] 数据云端存储
- [ ] 多设备同步
- [ ] 数据备份恢复
- [ ] 数据加密

## 📱 响应式设计

页面完全响应式，支持各种设备：

- **桌面端**：三列图表并排显示
- **平板**：图表自动换行
- **手机**：单列纵向显示

## ⚠️ 注意事项

1. **数据安全**
   - 数据仅存储在本地浏览器
   - 清除浏览器缓存会丢失数据
   - 建议定期备份

2. **金额单位**
   - 所有金额以日元（¥）为单位
   - 不支持小数点

3. **月份唯一性**
   - 每个月份只能创建一条记录
   - 如需修改月份，请先删除再重建

4. **图表显示**
   - 饼图仅显示支出分类
   - 柱状图和折线图显示最近3个月
   - 数据不足3个月也会正常显示

5. **自动计算**
   - 月度总收入 = 所有收入项目之和
   - 月度总支出 = 所有支出项目之和
   - 不需要手动计算

## 🐛 常见问题

### Q: 为什么图表没有数据？
A: 请先创建月度记录并添加收支项目。

### Q: 如何修改某个月的收入？
A: 点击该月份，编辑对应的收入项目即可。

### Q: 可以查看一年的数据吗？
A: 可以，表格支持分页，可以查看所有历史记录。

### Q: 图表能导出吗？
A: 目前暂不支持，未来版本会添加。

### Q: 数据能跨浏览器同步吗？
A: 目前不支持，数据仅存储在当前浏览器。

---

**版本**: 1.0.0  
**最后更新**: 2024年11月12日

